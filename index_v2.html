<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Life RPG: Personal Best</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        :root {
            --bg: #fdfdfd;
            --primary: #007aff;
            --text-main: #000;
            --text-muted: #94a3b8;
            --blue-mesh: radial-gradient(circle at 70% 20%, #7000ff 0%, transparent 50%),
                        radial-gradient(circle at 20% 80%, #00d2ff 0%, #0055ff 100%);
            --record-gold: #fbbf24;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Rubik', sans-serif; background: var(--bg); color: var(--text-main); margin: 0; padding: 0; height: 100vh; overflow: hidden; }

        .app-shell { height: 100vh; display: flex; flex-direction: column; }
        header { padding: 50px 25px 10px; display: flex; justify-content: space-between; align-items: flex-start; }
        .main-title { font-size: 2rem; font-weight: 900; margin: 0; }
        
        /* Record Badge */
        .record-badge { 
            background: rgba(251, 191, 36, 0.1); border: 1px solid var(--record-gold);
            color: var(--record-gold); padding: 4px 10px; border-radius: 50px;
            font-size: 0.7rem; font-weight: 900; display: flex; align-items: center; gap: 4px;
        }

        main { flex: 1; overflow-y: auto; padding: 0 20px 100px; }
        main::-webkit-scrollbar { display: none; }

        /* Stats Card */
        .stats-card { background: #fff; border-radius: 30px; padding: 20px; margin-bottom: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.03); border: 1px solid #f1f1f1; }
        .chart-container { display: flex; justify-content: space-between; align-items: flex-end; height: 60px; margin-top: 15px; }
        .bar-bg { background: #f8fafc; width: 10%; height: 100%; border-radius: 8px; position: relative; overflow: hidden; }
        .bar-fill { position: absolute; bottom: 0; width: 100%; background: #000; transition: height 0.6s ease; }

        /* Amharic Mesh Card */
        .mesh-card { border-radius: 30px; padding: 24px; margin-bottom: 20px; color: white; background: var(--blue-mesh); position: relative; overflow: hidden; box-shadow: 0 10px 30px rgba(0,122,255,0.2); }
        .card-label { font-size: 0.8rem; font-weight: 700; opacity: 0.8; text-transform: uppercase; letter-spacing: 1px; }
        .am-word { font-size: 2.6rem; font-weight: 900; display: block; text-align: center; margin: 15px 0; }
        .reveal-box { background: rgba(255,255,255,0.2); backdrop-filter: blur(10px); padding: 12px; border-radius: 18px; text-align: center; font-weight: 700; transition: 0.3s; }
        .reveal-box.hidden { filter: blur(10px); opacity: 0.5; }

        /* Quiz */
        .quiz-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .quiz-btn { background: #fff; border: none; padding: 12px; border-radius: 15px; font-weight: 700; font-size: 0.85rem; color: #000; }

        /* Habits */
        .task-row { background: #fff; border-radius: 20px; padding: 16px; margin-bottom: 10px; display: flex; align-items: center; justify-content: space-between; border: 1px solid #f1f1f1; }
        .task-row.done { opacity: 0.4; }
        .check-circle { width: 22px; height: 22px; border: 2px solid #e5e7eb; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; }
        .done .check-circle { background: #000; border-color: #000; color: #fff; }

        /* Navigation */
        .nav { position: fixed; bottom: 0; width: 100%; height: 80px; background: rgba(255,255,255,0.9); backdrop-filter: blur(20px); border-top: 1px solid #f1f1f1; display: flex; justify-content: space-around; align-items: center; }
        .nav-btn { color: #d1d5db; background: none; border: none; padding: 10px; }
        .nav-btn.active { color: #000; }
        .fab { position: fixed; bottom: 95px; left: 20px; width: 56px; height: 56px; border-radius: 50%; background: #000; color: #fff; border: none; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
    </style>
</head>
<body>

    <div class="app-shell">
        <header>
            <div>
                <div style="font-size: 0.8rem; font-weight: 700; color: var(--text-muted);">המסע של היום</div>
                <h1 class="main-title">הצייד</h1>
            </div>
            <div id="recordDisplay" class="record-badge" style="display: none;">
                <i data-lucide="trophy" style="width: 12px; height: 12px;"></i>
                שיא חדש!
            </div>
        </header>

        <main id="mainView">
            <div class="stats-card">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="font-weight: 900; font-size: 0.9rem;">עקומת שיפור</span>
                    <span id="bestEver" style="font-size: 0.7rem; font-weight: 700; color: var(--record-gold);">שיא: 0 XP</span>
                </div>
                <div class="chart-container" id="chart"></div>
            </div>

            <div class="mesh-card">
                <span class="card-label">למידה יומית</span>
                <span class="am-word" id="am">...</span>
                <div id="reveal" class="reveal-box hidden">???</div>
                <div class="quiz-grid" id="quiz"></div>
            </div>

            <div style="margin: 20px 5px 10px; font-weight: 900; font-size: 1.2rem;">הרגלים</div>
            <div id="habitList"></div>
        </main>

        <nav class="nav">
            <button class="nav-btn active" onclick="location.reload()"><i data-lucide="zap"></i></button>
            <button class="nav-btn" onclick="alert('הספריה בבניה')"><i data-lucide="library"></i></button>
        </nav>
    </div>

    <button class="fab" onclick="addH()"><i data-lucide="plus"></i></button>

    <script>
        const dict = [
            { am: "Bet", mean: "בית" }, { am: "Terepeza", mean: "שולחן" }, 
            { am: "Alga", mean: "מיטה" }, { am: "Hisab", mean: "חשבון" }, 
            { am: "Mekfel", mean: "לשלם" }
        ];

        let state = JSON.parse(localStorage.getItem('arch_record_v1')) || {
            xp: 0, wordIdx: 0,
            habits: [{id:1, txt:"מקלחת קרה", done:false}, {id:2, txt:"סידור מיטה", done:false}],
            history: {},
            bestDayXp: 0
        };

        function save() {
            const today = new Date().toISOString().split('T')[0];
            const currentDayXp = (state.habits.filter(h=>h.done).length * 20) + (state.wordIdx * 50);
            
            // בדיקת שיא
            if(currentDayXp > state.bestDayXp) {
                if(state.bestDayXp > 0) {
                    confetti({ particleCount: 150, spread: 70, colors: ['#fbbf24', '#ffffff'] });
                    document.getElementById('recordDisplay').style.display = 'flex';
                }
                state.bestDayXp = currentDayXp;
            }

            state.history[today] = currentDayXp;
            localStorage.setItem('arch_record_v1', JSON.stringify(state));
            render();
        }

        function render() {
            // Stats
            document.getElementById('bestEver').innerText = `שיא: ${state.bestDayXp} XP`;
            renderChart();

            // Word
            const w = dict[state.wordIdx % dict.length];
            document.getElementById('am').innerText = w.am;
            const rev = document.getElementById('reveal');
            rev.innerText = "???"; rev.classList.add('hidden');

            const q = document.getElementById('quiz');
            const dist = dict[(state.wordIdx+1)%dict.length];
            const opts = [w.mean, dist.mean].sort(()=>Math.random()-0.5);
            q.innerHTML = opts.map(o => `<button class="quiz-btn" onclick="check('${o}','${w.mean}')">${o}</button>`).join('');

            // Habits
            document.getElementById('habitList').innerHTML = state.habits.map(h => `
                <div class="task-row ${h.done?'done':''}" onclick="toggleH(${h.id})">
                    <span style="font-weight:700;">${h.txt}</span>
                    <div class="check-circle">${h.done?'✓':''}</div>
                </div>
            `).join('');
            lucide.createIcons();
        }

        function renderChart() {
            const chart = document.getElementById('chart');
            const days = ['א','ב','ג','ד','ה','ו','ש'];
            const todayIdx = new Date().getDay();
            let html = '';
            for(let i=0; i<7; i++) {
                const date = new Date();
                date.setDate(date.getDate() - (todayIdx - i));
                const dateStr = date.toISOString().split('T')[0];
                const val = state.history[dateStr] || 0;
                const height = Math.min((val / (state.bestDayXp || 100)) * 100, 100);
                html += `
                    <div class="bar-bg">
                        <div class="bar-fill" style="height: ${height}%"></div>
                    </div>
                `;
            }
            chart.innerHTML = html;
        }

        function check(chosen, correct) {
            if(chosen===correct) {
                document.getElementById('reveal').innerText = correct;
                document.getElementById('reveal').classList.remove('hidden');
                confetti({particleCount:80, origin:{y:0.7}});
                state.xp += 50;
                setTimeout(() => { state.wordIdx++; save(); }, 1800);
            } else { alert("נסה שוב!"); }
        }

        function toggleH(id) {
            const h = state.habits.find(x => x.id===id);
            h.done = !h.done;
            save();
        }

        function addH() {
            const t = prompt("הרגל חדש:");
            if(t) { state.habits.push({id:Date.now(), txt:t, done:false}); save(); }
        }

        render();
    </script>
</body>
</html>
